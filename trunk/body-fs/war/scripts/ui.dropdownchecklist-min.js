	/*
	 * ui.dropdownchecklist
	 * 
	 * Copyright (c) 2008-2009 Adrian Tosca Dual licensed under the MIT
	 * (MIT-LICENSE.txt) and GPL (GPL-LICENSE.txt) licenses.
	 * 
	 */
	// The dropdown check list jQuery plugin transforms a regular select html
	// element into a dropdown check list.
(function(g){g.widget("ui.dropdownchecklist",{_appendDropContainer:function(){var a=g("<div/>");a.addClass("ui-dropdownchecklist-dropcontainer-wrapper");a.css({position:"absolute",left:"-3300",top:"-3300px",width:"3000px",height:"3000px"});var b=g("<div/>");b.addClass("ui-dropdownchecklist-dropcontainer").css("overflow-y","auto");a.append(b);a.insertAfter(this.sourceSelect);a.drop=false;return a},_isDropDownKeyShortcut:function(a){return a.altKey&&g.ui.keyCode.DOWN==(a.keyCode||a.which)},_isDroDownCloseKey:function(a){return g.ui.keyCode.ESCAPE==
(a.keyCode||a.which)},_handleKeyboard:function(a){var b=this;if(b._isDropDownKeyShortcut(a)){a.stopPropagation();b._toggleDropContainer();b.dropWrapper.find("input:first").focus()}else b.dropWrapper.drop&&b._isDroDownCloseKey(a)&&b._toggleDropContainer()},_appendControl:function(){var a=this,b=this.sourceSelect,c=g("<span/>");c.addClass("ui-dropdownchecklist-wrapper");c.css({display:"inline-block",cursor:"default"});var d=g("<span/>");d.addClass("ui-dropdownchecklist");d.css({display:"inline-block"});
d.attr("tabIndex",0);d.keyup(function(f){a._handleKeyboard(f)});c.append(d);var e=g("<span/>");e.addClass("ui-dropdownchecklist-text");e.css({display:"inline-block",overflow:"hidden"});d.append(e);c.hover(function(){a.disabled||d.toggleClass("ui-dropdownchecklist-hover")},function(){a.disabled||d.toggleClass("ui-dropdownchecklist-hover")});c.click(function(f){if(!a.disabled){f.stopPropagation();a._toggleDropContainer()}});c.insertAfter(b);return c},_createDropItem:function(a,b,c,d,e){var f=this,h=
g("<div/>");h.addClass("ui-dropdownchecklist-item");h.css({whiteSpace:"nowrap"});d=d?' checked="checked"':"";var k=f.sourceSelect.attr("id")||"ddcl",l=k+a,j;j=f.initialMultiple?g('<input type="checkbox" id="'+l+'"'+d+"/>"):g('<input type="radio" id="'+l+'" name="'+k+'"'+d+"/>");j=j.attr("index",a).val(b);h.append(j);a=g("<label for="+l+"/>");a.addClass("ui-dropdownchecklist-text").css({cursor:"default",width:"100%"}).text(c);e&&h.addClass("ui-dropdownchecklist-indent");h.append(a);h.hover(function(){h.addClass("ui-dropdownchecklist-item-hover")},
function(){h.removeClass("ui-dropdownchecklist-item-hover")});j.click(function(i){i.stopPropagation();f._syncSelected(g(this));f.sourceSelect.trigger("change")});a.click(function(i){i.stopPropagation()});h.click(function(i){i.stopPropagation();i=j.attr("checked");j.attr("checked",!i);f._syncSelected(j);f.sourceSelect.trigger("change")});h.keyup(function(i){f._handleKeyboard(i)});return h},_createGroupItem:function(a){var b=g("<div />");b.addClass("ui-dropdownchecklist-group");b.css({whiteSpace:"nowrap"});
var c=g("<span/>");c.addClass("ui-dropdownchecklist-text").css({cursor:"default",width:"100%"}).text(a);b.append(c);return b},_appendItems:function(){var a=this,b=this.sourceSelect,c=this.dropWrapper.find(".ui-dropdownchecklist-dropcontainer");c.css({"float":"left"});b.children().each(function(e){var f=g(this);if(f.is("option"))a._appendOption(f,c,e,false);else{var h=f.attr("label");h=a._createGroupItem(h);c.append(h);a._appendOptions(f,c,e,true)}});b=c.outerWidth();var d=c.outerHeight();c.css({"float":""});
return{width:b,height:d}},_appendOptions:function(a,b,c,d){var e=this;a.children("option").each(function(f){var h=g(this);e._appendOption(h,b,c+"."+f,d)})},_appendOption:function(a,b,c,d){var e=this,f=a.text(),h=a.val();a=a.attr("selected");c=e._createDropItem(c,h,f,a,d);b.append(c)},_syncSelected:function(a){var b=this,c=this.options,d=this.sourceSelect,e=this.dropWrapper.find("input");if(c.firstItemChecksAll)if(a.attr("index")==0)e.attr("checked",a.attr("checked"));else{var f;f=true;e.each(function(k){if(k>
0)g(this).attr("checked")||(f=false)});a=e.filter(":first");a.attr("checked",false);f&&a.attr("checked",true)}var h=d.get(0).options;e.each(function(k){g(h[k]).attr("selected",g(this).attr("checked"))});b._updateControlText()},_updateControlText:function(){var a=this,b=this.sourceSelect,c=this.options,d=this.controlWrapper,e=b.find("option:first");e=null!=e&&e.attr("selected");b=b.find("option");a=a._formatText(b,c.firstItemChecksAll,e);d=d.find(".ui-dropdownchecklist-text");d.text(a);d.attr("title",
a)},_formatText:function(a,b,c){var d;if(b&&c)d=a.filter(":first").text();else{d="";a.each(function(){if(g(this).attr("selected"))d+=g(this).text()+", "});if(d.length>0)d=d.substring(0,d.length-2)}return d},_toggleDropContainer:function(){var a=this,b=this.controlWrapper,c=function(){var e=g.ui.dropdownchecklist.drop;if(null!=e){e.dropWrapper.css({top:"-3300px",left:"-3300px"});e.controlWrapper.find(".ui-dropdownchecklist").toggleClass("ui-dropdownchecklist-active");e.dropWrapper.find("input").attr("tabIndex",
-1);e.dropWrapper.drop=false;g.ui.dropdownchecklist.drop=null;g(document).unbind("click",c);a.sourceSelect.trigger("blur")}},d=function(e){null!=g.ui.dropdownchecklist.drop&&c();var f=e.controlWrapper.offset();e.dropWrapper.offset({left:f.left,top:f.top+e.controlWrapper.height()});f=b.parents().map(function(){var h=g(this).css("z-index");return isNaN(h)?0:h}).get();f=Math.max.apply(Math,f);f>0&&e.dropWrapper.css({zIndex:f+1});e.controlWrapper.find(".ui-dropdownchecklist").toggleClass("ui-dropdownchecklist-active");
e.dropWrapper.find("input").attr("tabIndex",0);e.dropWrapper.drop=true;g.ui.dropdownchecklist.drop=e;g(document).bind("click",c);a.sourceSelect.trigger("focus")};this.dropWrapper.drop?c(a):d(a)},_setSize:function(a){var b=this.options,c=this.dropWrapper,d=this.controlWrapper,e;if(b.width)e=parseInt(b.width);else{e=a.width;var f=b.minWidth;if(e<f)e=f}d.find(".ui-dropdownchecklist-text").css({width:e+"px"});d=d.outerWidth();b=b.maxDropHeight?parseInt(b.maxDropHeight):a.height;a=a.width<d?d:a.width;
g(c).css({width:a+"px",height:b+"px"});c.find(".ui-dropdownchecklist-dropcontainer").css({height:b+"px"})},_init:function(){var a=this,b=this.options,c=a.element;a.initialDisplay=c.css("display");c.css("display","none");a.initialMultiple=c.attr("multiple");c.attr("multiple","multiple");a.sourceSelect=c;var d=a._appendDropContainer();a.dropWrapper=d;var e=a._appendItems(),f=a._appendControl();a.controlWrapper=f;a._updateControlText(f,d,c);a._setSize(e);b.bgiframe&&typeof a.dropWrapper.bgiframe=="function"&&
a.dropWrapper.bgiframe()},enable:function(){this.controlWrapper.find(".ui-dropdownchecklist").removeClass("ui-dropdownchecklist-disabled");this.disabled=false},disable:function(){this.controlWrapper.find(".ui-dropdownchecklist").addClass("ui-dropdownchecklist-disabled");this.disabled=true},destroy:function(){g.widget.prototype.destroy.apply(this,arguments);this.sourceSelect.css("display",this.initialDisplay);this.sourceSelect.attr("multiple",this.initialMultiple);this.controlWrapper.unbind().remove();
this.dropWrapper.remove()}});g.extend(g.ui.dropdownchecklist,{defaults:{width:null,maxDropHeight:null,firstItemChecksAll:false,minWidth:50,bgiframe:false}})})(jQuery);